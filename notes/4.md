# 状态管理

状态管理可简单的理解为公共的数据管理，简化了组件之间数据的共享和组件间的通信

###  父子组件通信

父组件给子组件传值，通过`props`方式：子组件通过`props`属性接收父组件的数据。

```vue
<!-- 父组件 -->
<template>
    <!-- 这里的 sonValue 是子组件的 props -->
   <C-Input :sonValue="fatherValue"></C-Input>
</template>
<script>
import CInput from "@/components/CInput.vue";
export default {
  name: "store",
  data() {
    return {
      fatherValue: "chj"
    };
  },
  components: {
    CInput
    }
};
</script>
```

```vue
<!-- 子组件 -->
<template>
    <!-- 这里的 sonValue 是子组件的 props , props 不在响应系统里-->
   <input type="text"></unput>
</template>
<script>
export default {
  name: "CIput",
  props:{
      sonValue:{
          type:String
      }
  }
  data() {
    return {
      value: "chj"
    }
  }
};
</script>
```

子组件给父组件传值，通过父组件监听子组件的自定义事件。

```vue
<!-- 父组件 -->
<template>
  <div>
     <!-- 这里的 input 就是子组件的自定义事件，而父组件来监听处理 -->
     <!-- 这里监听的事件名称要和子组件emit的事件名称一致 -->
    <C-Input :value="inputValue"  @input="handleInput"></C-Input>
    <p>{{inputValue}}</p>
  </div>
</template>
<script>
import CInput from "@/components/CInput.vue";
export default {
  name: "store",
  data() {
    return {
      inputValue: ""
    };
  },
  components: {
    CInput
  },
  methods: {
    // 在子组件事件的处理函数里面，可以接收子组件传递的数据  
    // 这里的参数val就是子组件emit过来的参数
    handleInput(val) {
      this.inputValue = val;
    }
  }
};
</script>
```

```vue
<!-- 子组件 -->
<template>
  <!-- 子组件通过触发一个事件，在事件处理函数内emit子组件的数据给父组件 -->
  <!-- 请注意这里的input事件是input自带的，和emit里面的不一样 --> 
  <input type="text"  @input="handleInput" :value="value" />
</template>

<script>
export default {
  name: "CInput",
  props: {
    value: {
      type: [String, Number],
      default: ""
    }
  },
  methods: {
    handleInput(event) {
      // 获取文本框的值
      const value = event.target.value;
      //本子组件emit了一个自定义事件input，并将文本框的值发送给父组件
      // 这里的input是一个自定义的事件名称，不是input标签的input事件  
      this.$emit("input", value);
    }
  }
};
</script>
```

### 兄弟组件之间通信

兄弟组件之间无法直接通信，需要通过共同的父组件，父组件作为中间的桥梁：兄弟组件之一emit传值给父组件，父组件接收之后另外的子组件再通过props接收。

```vue
<!--  子组件一  -->
<!--
	该组件通过触发自定义事件input，将数据传递给父组件
-->
<template>
  <div>
    兄弟组件CInput：
    <input type="text" @input="handleInput" :value="value" />
  </div>
</template>

<script>
export default {
  name: "CInput",
  props: {
    value: {
      type: [String, Number],
      default: ""
    }
  },
  methods: {
    handleInput(event) {
      // 获取文本框的值
      const value = event.target.value;
      //本子组件emit了一个事件input，并将文本框的值发送给父组件
      this.$emit("input", value);
    }
  }
};
</script>
```

```vue
<!-- 父组件 -->
<!-- 
	父组件监听了其中一个子组件的自定义事件，
   并且在事件处理函数内接收到了子组件传递来的数据
    
   然后又通过props传值给另外一个子组件
-->
<template>
  <div>
    <p>父组件：{{inputValue}}</p>
      <!-- 父组件监听子组件事件并接收参数 -->
    <C-Input @input="handleInput"></C-Input>
       <!-- 父组件传值给子组件 -->
    <C-Show :content="inputValue"></C-Show>
  </div>
</template>

<script>
import CInput from "@/components/CInput.vue";
import CShow from "@/components/CShow.vue";
export default {
  name: "store",
  data() {
    return {
      inputValue: ""
    };
  },
  components: {
    CInput,
    CShow
  },
  methods: {
    // 这里的参数val就是子组件emit过来的参数
    handleInput(val) {
      this.inputValue = val;
    }
  }
};
</script>
```

```vue
<!-- 另外一个子组件 -->
<!--
   接收来自父组件的数据
-->
<template>
  <div>
    <p>兄弟组件CShow:{{content}}</p>
  </div>
</template>


<script>
export default {
  name: "CShow",
  props: {
    content: {
      type: [String, Number],
      default: ""
    }
  }
};
</script>
```

## Bus

前面兄弟组件传值的前提是有一个公共的父组件，当两个组件不是父子关系的时候，而且没有公共的父组件的时候怎么传值？比如`App.vue`中：

```vue
<transition-group name="router">
      <router-view key="default" />
      <router-view name="email" key="email" />
      <router-view name="tel" key="tel" />
      <router-view name="login" key="login" />
</transition-group>
```

email和tel对应的组件，都不是App.vue的子组件，而且之间也没有层级关系。所以，需要使用`Bus`。

这里的`Bus`就像它的名字一样，“往返”需要数据交换的组件之间。

### 创建`Bus`

```javascript
// 创建 Bus 
// src\bus\index.js 
import Vue from "vue";
//创建一个Vue实例,不需要任意选项
const Bus = new Vue();
//导出
export default Bus;
```

### 引入`Bus`并设置为Vue实例的属性

在`main.js`全局引入

```javascript
import Bus from '@/bus'
//Vue实例注入$bus
Vue.prototype.$bus= Bus
```

当要在任意组建内使用这个`bus`的时候只需要`this.$bus`来获取这个特殊的Vue实例

假设email组件传值给tel组件：

```vue
<!-- Email.vue -->
<template>
  <div>
    <p class="email">邮箱地址是:example@domain.com</p>

    <button @click="handleClick">传值给 tel</button>
  </div>
</template>
<script>
export default {
  name: "Email",
  methods: {
    handleClick() {
        //  “通信车”通过自定义事件携带数据
      this.$bus.$emit("pass", "hello");
    }
  }
};
</script>
```

```vue
<!-- Tel.vue -->
<template>
  <div>
    <p class="tel">电话是：18888888888</p>
    <p>{{msg}}</p>
  </div>
</template>

<script>
export default {
  name: "Tel",
  data() {
    return {
      msg: ""
    };
  },
  mounted() {
    //“通信车”监听发出自定义事件的组件，并且将接收发送的数据
    this.$bus.$on("pass", args => {
      this.msg = args;
    });
  }
};
</script>
```







## Vuex-基础-state&getter





## Vuex-基础-mutation&action/module





## Vuex-进阶